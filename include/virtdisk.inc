ifndef VIRT_DISK_API_DEF
VIRT_DISK_API_DEF equ <>

include winapifamily.inc

if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)

if ((WINVER GE _WIN32_WINNT_WIN7) OR defined(VIRTDISK_DEFINE_FLAGS))

ifndef _VIRTUAL_STORAGE_TYPE_DEFINED
_VIRTUAL_STORAGE_TYPE_DEFINED equ 1
VIRTUAL_STORAGE_TYPE	STRUC
DeviceId		ULONG ?
VendorId		GUID <>
VIRTUAL_STORAGE_TYPE	ENDS
PVIRTUAL_STORAGE_TYPE	typedef ptr VIRTUAL_STORAGE_TYPE
endif

ifdef DEFINE_GUID
DEFINE_GUID(VIRTUAL_STORAGE_TYPE_VENDOR_UNKNOWN, 0x00000000, 0x0000, 0x0000, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00)

;; {EC984AEC-A0F9-47e9-901F-71415A66345B}
DEFINE_GUID(VIRTUAL_STORAGE_TYPE_VENDOR_MICROSOFT, 0xec984aec, 0xa0f9, 0x47e9, 0x90, 0x1f, 0x71, 0x41, 0x5a, 0x66, 0x34, 0x5b)
endif


VIRTUAL_STORAGE_TYPE_DEVICE_UNKNOWN equ 0
VIRTUAL_STORAGE_TYPE_DEVICE_ISO equ 1
VIRTUAL_STORAGE_TYPE_DEVICE_VHD equ 2
VIRTUAL_STORAGE_TYPE_DEVICE_VHDX equ 3

if NOT defined(VIRTDISK_DEFINE_FLAGS)

OPEN_VIRTUAL_DISK_RW_DEPTH_DEFAULT equ 1

OPEN_VIRTUAL_DISK_VERSION typedef SDWORD
OPEN_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
OPEN_VIRTUAL_DISK_VERSION_1 equ 1
OPEN_VIRTUAL_DISK_VERSION_2 equ 2

OPEN_VIRTUAL_DISK_PARAMETERS STRUC
Version			OPEN_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  RWDepth		ULONG ?
 ENDS
 STRUC Version2
  GetInfoOnly		BOOL ?
  ReadOnly		BOOL ?
  ResiliencyGuid	GUID <>
 ENDS
ENDS
OPEN_VIRTUAL_DISK_PARAMETERS ENDS
POPEN_VIRTUAL_DISK_PARAMETERS typedef ptr OPEN_VIRTUAL_DISK_PARAMETERS

endif ;; VIRTDISK_DEFINE_FLAGS

VIRTUAL_DISK_ACCESS_MASK typedef SDWORD
VIRTUAL_DISK_ACCESS_NONE equ 0x00000000
VIRTUAL_DISK_ACCESS_ATTACH_RO equ 0x00010000
VIRTUAL_DISK_ACCESS_ATTACH_RW equ 0x00020000
VIRTUAL_DISK_ACCESS_DETACH equ 0x00040000
VIRTUAL_DISK_ACCESS_GET_INFO equ 0x00080000
VIRTUAL_DISK_ACCESS_CREATE equ 0x00100000
VIRTUAL_DISK_ACCESS_METAOPS equ 0x00200000
VIRTUAL_DISK_ACCESS_READ equ 0x000d0000
VIRTUAL_DISK_ACCESS_ALL equ 0x003f0000
VIRTUAL_DISK_ACCESS_WRITABLE equ 0x00320000

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(VIRTUAL_DISK_ACCESS_MASK)
endif

;; Flags for OpenVirtualDisk
OPEN_VIRTUAL_DISK_FLAG	typedef SDWORD
OPEN_VIRTUAL_DISK_FLAG_NONE equ 0x00000000
OPEN_VIRTUAL_DISK_FLAG_NO_PARENTS equ 0x00000001
OPEN_VIRTUAL_DISK_FLAG_BLANK_FILE equ 0x00000002
OPEN_VIRTUAL_DISK_FLAG_BOOT_DRIVE equ 0x00000004
OPEN_VIRTUAL_DISK_FLAG_CACHED_IO equ 0x00000008
OPEN_VIRTUAL_DISK_FLAG_CUSTOM_DIFF_CHAIN equ 0x00000010
OPEN_VIRTUAL_DISK_FLAG_PARENT_CACHED_IO equ 0x00000020

if NOT defined(VIRTDISK_DEFINE_FLAGS)

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(OPEN_VIRTUAL_DISK_FLAG);
endif

;DWORD
OpenVirtualDisk proto WINAPI \
    VirtualStorageType: PVIRTUAL_STORAGE_TYPE,
		  Path: PCWSTR,
 VirtualDiskAccessMask: VIRTUAL_DISK_ACCESS_MASK,
		 Flags: OPEN_VIRTUAL_DISK_FLAG,
	    Parameters: POPEN_VIRTUAL_DISK_PARAMETERS,
		Handle: PHANDLE


CREATE_VIRTUAL_DISK_PARAMETERS_DEFAULT_BLOCK_SIZE equ 0

CREATE_VIRTUAL_DISK_PARAMETERS_DEFAULT_SECTOR_SIZE equ 0

CREATE_VIRTUAL_DISK_VERSION typedef SDWORD
CREATE_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
CREATE_VIRTUAL_DISK_VERSION_1 equ 1
CREATE_VIRTUAL_DISK_VERSION_2 equ 2


CREATE_VIRTUAL_DISK_PARAMETERS STRUC
Version			CREATE_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  UniqueId		 GUID <>
  MaximumSize		 ULONGLONG ?
  BlockSizeInBytes	 ULONG ?
  SectorSizeInBytes	 ULONG ?
  ParentPath		 PCWSTR ?
  SourcePath		 PCWSTR ?
 ENDS
 STRUC Version2
  UniqueId		 GUID <>
  MaximumSize		 ULONGLONG ?
  BlockSizeInBytes	 ULONG ?
  SectorSizeInBytes	 ULONG ?
  PhysicalSectorSizeInBytes ULONG ?
  ParentPath		 PCWSTR ?
  SourcePath		 PCWSTR ?
  OpenFlags		 OPEN_VIRTUAL_DISK_FLAG ?
  ParentVirtualStorageType VIRTUAL_STORAGE_TYPE <>
  SourceVirtualStorageType VIRTUAL_STORAGE_TYPE <>
  ResiliencyGuid	 GUID <>
 ENDS
ENDS
CREATE_VIRTUAL_DISK_PARAMETERS ENDS
PCREATE_VIRTUAL_DISK_PARAMETERS typedef ptr CREATE_VIRTUAL_DISK_PARAMETERS

;; Flags for CreateVirtualDisk
CREATE_VIRTUAL_DISK_FLAG typedef SDWORD
CREATE_VIRTUAL_DISK_FLAG_NONE equ 0x0
CREATE_VIRTUAL_DISK_FLAG_FULL_PHYSICAL_ALLOCATION equ 0x1
CREATE_VIRTUAL_DISK_FLAG_PREVENT_WRITES_TO_SOURCE_DISK equ 0x2
CREATE_VIRTUAL_DISK_FLAG_DO_NOT_COPY_METADATA_FROM_PARENT equ 0x4

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(CREATE_VIRTUAL_DISK_FLAG);
endif

;DWORD
CreateVirtualDisk proto WINAPI \
    VirtualStorageType: PVIRTUAL_STORAGE_TYPE,
		  Path: PCWSTR,
 VirtualDiskAccessMask: VIRTUAL_DISK_ACCESS_MASK,
    SecurityDescriptor: PSECURITY_DESCRIPTOR,
		 Flags: CREATE_VIRTUAL_DISK_FLAG,
 ProviderSpecificFlags: ULONG,
	    Parameters: PCREATE_VIRTUAL_DISK_PARAMETERS,
	    Overlapped: LPOVERLAPPED,
		Handle: PHANDLE

ATTACH_VIRTUAL_DISK_VERSION typedef SDWORD
ATTACH_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
ATTACH_VIRTUAL_DISK_VERSION_1 equ 1

ATTACH_VIRTUAL_DISK_PARAMETERS STRUC
Version			ATTACH_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  Reserved		ULONG ?
 ENDS
ENDS
ATTACH_VIRTUAL_DISK_PARAMETERS ENDS
PATTACH_VIRTUAL_DISK_PARAMETERS typedef ptr ATTACH_VIRTUAL_DISK_PARAMETERS

endif ;; VIRTDISK_DEFINE_FLAGS

;; Flags for AttachVirtualDisk
ATTACH_VIRTUAL_DISK_FLAG typedef SDWORD
ATTACH_VIRTUAL_DISK_FLAG_NONE equ 0x00000000
ATTACH_VIRTUAL_DISK_FLAG_READ_ONLY equ 0x00000001
ATTACH_VIRTUAL_DISK_FLAG_NO_DRIVE_LETTER equ 0x00000002
ATTACH_VIRTUAL_DISK_FLAG_PERMANENT_LIFETIME equ 0x00000004
ATTACH_VIRTUAL_DISK_FLAG_NO_LOCAL_HOST equ 0x00000008

if NOT defined(VIRTDISK_DEFINE_FLAGS)

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(ATTACH_VIRTUAL_DISK_FLAG);
endif

;DWORD
AttachVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE,
    SecurityDescriptor: PSECURITY_DESCRIPTOR,
		 Flags: ATTACH_VIRTUAL_DISK_FLAG,
 ProviderSpecificFlags: ULONG,
	    Parameters: PATTACH_VIRTUAL_DISK_PARAMETERS,
	    Overlapped: LPOVERLAPPED

endif ;; VIRTDISK_DEFINE_FLAGS

DETACH_VIRTUAL_DISK_FLAG typedef SDWORD
DETACH_VIRTUAL_DISK_FLAG_NONE equ 0x00000000

if NOT defined(VIRTDISK_DEFINE_FLAGS)

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(DETACH_VIRTUAL_DISK_FLAG);
endif

;DWORD
DetachVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE,
		 Flags: DETACH_VIRTUAL_DISK_FLAG,
 ProviderSpecificFlags: ULONG

;DWORD
GetVirtualDiskPhysicalPath proto WINAPI \
     VirtualDiskHandle: HANDLE,
   DiskPathSizeInBytes: PULONG,
	      DiskPath: PWSTR

;DWORD
GetAllAttachedVirtualDiskPhysicalPaths proto WINAPI \
PathsBufferSizeInBytes: PULONG,
	   PathsBuffer: PWSTR

endif ;; VIRTDISK_DEFINE_FLAGS

DEPENDENT_DISK_FLAG	typedef SDWORD
DEPENDENT_DISK_FLAG_NONE equ 0x00000000
DEPENDENT_DISK_FLAG_MULT_BACKING_FILES equ 0x00000001
DEPENDENT_DISK_FLAG_FULLY_ALLOCATED equ 0x00000002
DEPENDENT_DISK_FLAG_READ_ONLY equ 0x00000004
DEPENDENT_DISK_FLAG_REMOTE equ 0x00000008
DEPENDENT_DISK_FLAG_SYSTEM_VOLUME equ 0x00000010
DEPENDENT_DISK_FLAG_SYSTEM_VOLUME_PARENT equ 0x00000020
DEPENDENT_DISK_FLAG_REMOVABLE equ 0x00000040
DEPENDENT_DISK_FLAG_NO_DRIVE_LETTER equ 0x00000080
DEPENDENT_DISK_FLAG_PARENT equ 0x00000100
DEPENDENT_DISK_FLAG_NO_HOST_DISK equ 0x00000200
DEPENDENT_DISK_FLAG_PERMANENT_LIFETIME equ 0x00000400

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(DEPENDENT_DISK_FLAG);
endif

if NOT defined(VIRTDISK_DEFINE_FLAGS)

STORAGE_DEPENDENCY_INFO_VERSION typedef SDWORD
STORAGE_DEPENDENCY_INFO_VERSION_UNSPECIFIED equ 0
STORAGE_DEPENDENCY_INFO_VERSION_1 equ 1
STORAGE_DEPENDENCY_INFO_VERSION_2 equ 2

STORAGE_DEPENDENCY_INFO_TYPE_1 STRUC
DependencyTypeFlags	DEPENDENT_DISK_FLAG ?
ProviderSpecificFlags	ULONG ?
VirtualStorageType	VIRTUAL_STORAGE_TYPE <>
STORAGE_DEPENDENCY_INFO_TYPE_1 ENDS
PSTORAGE_DEPENDENCY_INFO_TYPE_1 typedef ptr STORAGE_DEPENDENCY_INFO_TYPE_1

STORAGE_DEPENDENCY_INFO_TYPE_2 STRUC
DependencyTypeFlags	DEPENDENT_DISK_FLAG ?
ProviderSpecificFlags	ULONG ?
VirtualStorageType	VIRTUAL_STORAGE_TYPE <>
AncestorLevel		ULONG ?
DependencyDeviceName	PWSTR ?
HostVolumeName		PWSTR ?
DependentVolumeName	PWSTR ?
DependentVolumeRelativePath PWSTR ?
STORAGE_DEPENDENCY_INFO_TYPE_2 ENDS
PSTORAGE_DEPENDENCY_INFO_TYPE_2 typedef ptr STORAGE_DEPENDENCY_INFO_TYPE_2

STORAGE_DEPENDENCY_INFO STRUC
Version			STORAGE_DEPENDENCY_INFO_VERSION ?
NumberEntries		ULONG ?
UNION
 Version1Entries	STORAGE_DEPENDENCY_INFO_TYPE_1 1 dup(<>)
 Version2Entries	STORAGE_DEPENDENCY_INFO_TYPE_2 1 dup(<>)
ENDS
STORAGE_DEPENDENCY_INFO ENDS
PSTORAGE_DEPENDENCY_INFO typedef ptr STORAGE_DEPENDENCY_INFO

endif ;; VIRTDISK_DEFINE_FLAGS

GET_STORAGE_DEPENDENCY_FLAG typedef SDWORD
GET_STORAGE_DEPENDENCY_FLAG_NONE equ 0x00000000
GET_STORAGE_DEPENDENCY_FLAG_HOST_VOLUMES equ 0x00000001
GET_STORAGE_DEPENDENCY_FLAG_DISK_HANDLE equ 0x00000002

GET_STORAGE_DEPENDENCY_FLAG_PARENTS equ GET_STORAGE_DEPENDENCY_FLAG_HOST_VOLUMES

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(GET_STORAGE_DEPENDENCY_FLAG);
endif

if NOT defined(VIRTDISK_DEFINE_FLAGS)

;DWORD
GetStorageDependencyInformation proto WINAPI \
	  ObjectHandle: HANDLE,
		 Flags: GET_STORAGE_DEPENDENCY_FLAG,
StorageDependencyInfoSize: ULONG,
 StorageDependencyInfo: PSTORAGE_DEPENDENCY_INFO,
	      SizeUsed: PULONG

GET_VIRTUAL_DISK_INFO_VERSION typedef SDWORD
GET_VIRTUAL_DISK_INFO_UNSPECIFIED equ 0
GET_VIRTUAL_DISK_INFO_SIZE equ 1
GET_VIRTUAL_DISK_INFO_IDENTIFIER equ 2
GET_VIRTUAL_DISK_INFO_PARENT_LOCATION equ 3
GET_VIRTUAL_DISK_INFO_PARENT_IDENTIFIER equ 4
GET_VIRTUAL_DISK_INFO_PARENT_TIMESTAMP equ 5
GET_VIRTUAL_DISK_INFO_VIRTUAL_STORAGE_TYPE equ 6
GET_VIRTUAL_DISK_INFO_PROVIDER_SUBTYPE equ 7
GET_VIRTUAL_DISK_INFO_IS_4K_ALIGNED equ 8
GET_VIRTUAL_DISK_INFO_PHYSICAL_DISK equ 9
GET_VIRTUAL_DISK_INFO_VHD_PHYSICAL_SECTOR_SIZE equ 10
GET_VIRTUAL_DISK_INFO_SMALLEST_SAFE_VIRTUAL_SIZE equ 11
GET_VIRTUAL_DISK_INFO_FRAGMENTATION equ 12
GET_VIRTUAL_DISK_INFO_IS_LOADED equ 13
GET_VIRTUAL_DISK_INFO_VIRTUAL_DISK_ID equ 14


GET_VIRTUAL_DISK_INFO	STRUC
Version			GET_VIRTUAL_DISK_INFO_VERSION ?
UNION
 STRUC _Size
  VirtualSize		ULONGLONG ?
  PhysicalSize		ULONGLONG ?
  BlockSize		ULONG ?
  SectorSize		ULONG ?
 ENDS
 Identifier		GUID <>
 STRUC ParentLocation
  ParentResolved	BOOL ?
  ParentLocationBuffer	WCHAR 1 dup(?) ;; MultiSz string
 ENDS
 ParentIdentifier	GUID <>
 ParentTimestamp	ULONG ?
 VirtualStorageType	VIRTUAL_STORAGE_TYPE <>
 ProviderSubtype	ULONG ?
 Is4kAligned		BOOL ?
 IsLoaded		BOOL ?
 STRUC PhysicalDisk
  LogicalSectorSize	 ULONG ?
  PhysicalSectorSize	 ULONG ?
  IsRemote		 BOOL ?
 ENDS
 VhdPhysicalSectorSize	 ULONG ?
 SmallestSafeVirtualSize ULONGLONG ?
 FragmentationPercentage ULONG ?
 VirtualDiskId		 GUID <>
ENDS
GET_VIRTUAL_DISK_INFO	ENDS
PGET_VIRTUAL_DISK_INFO	typedef ptr GET_VIRTUAL_DISK_INFO


;DWORD
GetVirtualDiskInformation proto WINAPI \
     VirtualDiskHandle: HANDLE,
   VirtualDiskInfoSize: PULONG,
       VirtualDiskInfo: PGET_VIRTUAL_DISK_INFO,
	      SizeUsed: PULONG

SET_VIRTUAL_DISK_INFO_VERSION typedef SDWORD
SET_VIRTUAL_DISK_INFO_UNSPECIFIED equ 0
SET_VIRTUAL_DISK_INFO_PARENT_PATH equ 1
SET_VIRTUAL_DISK_INFO_IDENTIFIER equ 2
SET_VIRTUAL_DISK_INFO_PARENT_PATH_WITH_DEPTH equ 3
SET_VIRTUAL_DISK_INFO_PHYSICAL_SECTOR_SIZE equ 4
SET_VIRTUAL_DISK_INFO_VIRTUAL_DISK_ID equ 5


SET_VIRTUAL_DISK_INFO	STRUC
Version			SET_VIRTUAL_DISK_INFO_VERSION ?
UNION
 ParentFilePath		PCWSTR ?
 UniqueIdentifier	GUID <>
 STRUC ParentPathWithDepthInfo
  ChildDepth		ULONG ?
  ParentFilePath	PCWSTR ?
 ENDS
 VhdPhysicalSectorSize	ULONG ?
 VirtualDiskId		GUID <>
ENDS
SET_VIRTUAL_DISK_INFO	ENDS
PSET_VIRTUAL_DISK_INFO	typedef ptr SET_VIRTUAL_DISK_INFO


;DWORD
SetVirtualDiskInformation proto WINAPI \
     VirtualDiskHandle: HANDLE,
       VirtualDiskInfo: PSET_VIRTUAL_DISK_INFO

if (NTDDI_VERSION GE NTDDI_WIN8)

;DWORD
EnumerateVirtualDiskMetadata proto WINAPI \
     VirtualDiskHandle: HANDLE,
	 NumberOfItems: PULONG,
		 Items: ptr GUID

GetVirtualDiskMetadata proto WINAPI \
     VirtualDiskHandle: HANDLE,
		  Item: ptr GUID,
	  MetaDataSize: PULONG,
	      MetaData: ptr

SetVirtualDiskMetadata proto WINAPI \
     VirtualDiskHandle: HANDLE,
		  Item: ptr GUID,
	  MetaDataSize: ULONG,
	      MetaData: ptr

DeleteVirtualDiskMetadata proto WINAPI \
     VirtualDiskHandle: HANDLE,
		  Item: ptr GUID

endif ;; NTDDI_VERSION GE NTDDI_WIN8

VIRTUAL_DISK_PROGRESS	STRUC
OperationStatus		dd ?
CurrentValue		ULONGLONG ?
CompletionValue		ULONGLONG ?
VIRTUAL_DISK_PROGRESS	ENDS
PVIRTUAL_DISK_PROGRESS	typedef ptr VIRTUAL_DISK_PROGRESS

;DWORD
GetVirtualDiskOperationProgress proto WINAPI \
     VirtualDiskHandle: HANDLE,
	    Overlapped: LPOVERLAPPED,
	      Progress: PVIRTUAL_DISK_PROGRESS

COMPACT_VIRTUAL_DISK_VERSION typedef SDWORD
COMPACT_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
COMPACT_VIRTUAL_DISK_VERSION_1 equ 1

COMPACT_VIRTUAL_DISK_PARAMETERS STRUC
Version			COMPACT_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  Reserved		ULONG ?
 ENDS
ENDS
COMPACT_VIRTUAL_DISK_PARAMETERS ENDS
PCOMPACT_VIRTUAL_DISK_PARAMETERS typedef ptr COMPACT_VIRTUAL_DISK_PARAMETERS

COMPACT_VIRTUAL_DISK_FLAG typedef SDWORD
COMPACT_VIRTUAL_DISK_FLAG_NONE equ 0x00000000
COMPACT_VIRTUAL_DISK_FLAG_NO_ZERO_SCAN equ 0x00000001
COMPACT_VIRTUAL_DISK_FLAG_NO_BLOCK_MOVES equ 0x00000002

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(COMPACT_VIRTUAL_DISK_FLAG);
endif

;DWORD
CompactVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE,
		 Flags: COMPACT_VIRTUAL_DISK_FLAG,
	    Parameters: PCOMPACT_VIRTUAL_DISK_PARAMETERS,
	    Overlapped: LPOVERLAPPED

MERGE_VIRTUAL_DISK_VERSION typedef SDWORD
MERGE_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
MERGE_VIRTUAL_DISK_VERSION_1 equ 1
MERGE_VIRTUAL_DISK_VERSION_2 equ 2

MERGE_VIRTUAL_DISK_DEFAULT_MERGE_DEPTH equ 1

MERGE_VIRTUAL_DISK_PARAMETERS STRUC
Version			MERGE_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  MergeDepth		ULONG ?
 ENDS
 STRUC Version2
  MergeSourceDepth	ULONG ?
  MergeTargetDepth	ULONG ?
 ENDS
ENDS
MERGE_VIRTUAL_DISK_PARAMETERS ENDS
PMERGE_VIRTUAL_DISK_PARAMETERS typedef ptr MERGE_VIRTUAL_DISK_PARAMETERS

MERGE_VIRTUAL_DISK_FLAG typedef SDWORD
MERGE_VIRTUAL_DISK_FLAG_NONE equ 0x00000000

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(MERGE_VIRTUAL_DISK_FLAG);
endif

;DWORD
MergeVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE,
		 Flags: MERGE_VIRTUAL_DISK_FLAG,
	    Parameters: PMERGE_VIRTUAL_DISK_PARAMETERS,
	    Overlapped: LPOVERLAPPED

EXPAND_VIRTUAL_DISK_VERSION typedef SDWORD
EXPAND_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
EXPAND_VIRTUAL_DISK_VERSION_1 equ 1

EXPAND_VIRTUAL_DISK_PARAMETERS STRUC
Version			EXPAND_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  NewSize		ULONGLONG ?
 ENDS
ENDS
EXPAND_VIRTUAL_DISK_PARAMETERS ENDS
PEXPAND_VIRTUAL_DISK_PARAMETERS typedef ptr EXPAND_VIRTUAL_DISK_PARAMETERS

EXPAND_VIRTUAL_DISK_FLAG typedef SDWORD
EXPAND_VIRTUAL_DISK_FLAG_NONE equ 0x00000000

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(EXPAND_VIRTUAL_DISK_FLAG);
endif

;DWORD
ExpandVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE,
		 Flags: EXPAND_VIRTUAL_DISK_FLAG,
	    Parameters: PEXPAND_VIRTUAL_DISK_PARAMETERS,
	    Overlapped: LPOVERLAPPED

RESIZE_VIRTUAL_DISK_VERSION typedef SDWORD
RESIZE_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
RESIZE_VIRTUAL_DISK_VERSION_1 equ 1

RESIZE_VIRTUAL_DISK_PARAMETERS STRUC
Version			RESIZE_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  NewSize		ULONGLONG ?
 ENDS
ENDS
RESIZE_VIRTUAL_DISK_PARAMETERS ENDS
PRESIZE_VIRTUAL_DISK_PARAMETERS typedef ptr RESIZE_VIRTUAL_DISK_PARAMETERS


RESIZE_VIRTUAL_DISK_FLAG typedef SDWORD
RESIZE_VIRTUAL_DISK_FLAG_NONE equ 0x0
RESIZE_VIRTUAL_DISK_FLAG_ALLOW_UNSAFE_VIRTUAL_SIZE equ 0x1
RESIZE_VIRTUAL_DISK_FLAG_RESIZE_TO_SMALLEST_SAFE_VIRTUAL_SIZE equ 0x2

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(RESIZE_VIRTUAL_DISK_FLAG);
endif

if (NTDDI_VERSION GE NTDDI_WIN8)

;DWORD
ResizeVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE,
		 Flags: RESIZE_VIRTUAL_DISK_FLAG,
	    Parameters: PRESIZE_VIRTUAL_DISK_PARAMETERS,
	    Overlapped: LPOVERLAPPED

endif

MIRROR_VIRTUAL_DISK_VERSION typedef SDWORD
MIRROR_VIRTUAL_DISK_VERSION_UNSPECIFIED equ 0
MIRROR_VIRTUAL_DISK_VERSION_1 equ 1

MIRROR_VIRTUAL_DISK_PARAMETERS STRUC
Version			MIRROR_VIRTUAL_DISK_VERSION ?
UNION
 STRUC Version1
  MirrorVirtualDiskPath PCWSTR ?
 ENDS
ENDS
MIRROR_VIRTUAL_DISK_PARAMETERS ENDS
PMIRROR_VIRTUAL_DISK_PARAMETERS typedef ptr MIRROR_VIRTUAL_DISK_PARAMETERS

MIRROR_VIRTUAL_DISK_FLAG typedef SDWORD
MIRROR_VIRTUAL_DISK_FLAG_NONE equ 0x00000000
MIRROR_VIRTUAL_DISK_FLAG_EXISTING_FILE equ 0x00000001

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(MIRROR_VIRTUAL_DISK_FLAG);
endif

if (NTDDI_VERSION GE NTDDI_WIN8)
;DWORD
MirrorVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE,
		 Flags: MIRROR_VIRTUAL_DISK_FLAG,
	    Parameters: PMIRROR_VIRTUAL_DISK_PARAMETERS,
	    Overlapped: LPOVERLAPPED
endif

if (NTDDI_VERSION GE NTDDI_WIN8)
;DWORD
BreakMirrorVirtualDisk proto WINAPI \
     VirtualDiskHandle: HANDLE
endif

if (NTDDI_VERSION GE NTDDI_WIN8)

;DWORD
AddVirtualDiskParent proto WINAPI \
     VirtualDiskHandle: HANDLE,
	    ParentPath: PCWSTR

endif
endif ;; VIRTDISK_DEFINE_FLAGS


SurfaceVirtualDisk	equ AttachVirtualDisk
UnsurfaceVirtualDisk	equ DetachVirtualDisk
VIRTUAL_DISK_ACCESS_SURFACE_RO equ VIRTUAL_DISK_ACCESS_ATTACH_RO
VIRTUAL_DISK_ACCESS_SURFACE_RW equ <VIRTUAL_DISK_ACCESS_ATTACH_RW>
VIRTUAL_DISK_ACCESS_UNSURFACE equ VIRTUAL_DISK_ACCESS_DETACH
SURFACE_VIRTUAL_DISK_VERSION_UNSPECIFIED equ ATTACH_VIRTUAL_DISK_VERSION_UNSPECIFIED
SURFACE_VIRTUAL_DISK_VERSION_1 equ ATTACH_VIRTUAL_DISK_VERSION_1
SURFACE_VIRTUAL_DISK_VERSION equ ATTACH_VIRTUAL_DISK_VERSION
_SURFACE_VIRTUAL_DISK_VERSION equ _ATTACH_VIRTUAL_DISK_VERSION
SURFACE_VIRTUAL_DISK_PARAMETERS equ ATTACH_VIRTUAL_DISK_PARAMETERS
PSURFACE_VIRTUAL_DISK_PARAMETERS equ PATTACH_VIRTUAL_DISK_PARAMETERS
_SURFACE_VIRTUAL_DISK_PARAMETERS equ _ATTACH_VIRTUAL_DISK_PARAMETERS

if NOT defined(__midl)

_SURFACE_VIRTUAL_DISK_FLAG equ _ATTACH_VIRTUAL_DISK_FLAG
SURFACE_VIRTUAL_DISK_FLAG_NONE equ ATTACH_VIRTUAL_DISK_FLAG_NONE
SURFACE_VIRTUAL_DISK_FLAG_READ_ONLY equ ATTACH_VIRTUAL_DISK_FLAG_READ_ONLY
SURFACE_VIRTUAL_DISK_FLAG_NO_DRIVE_LETTER equ ATTACH_VIRTUAL_DISK_FLAG_NO_DRIVE_LETTER
SURFACE_VIRTUAL_DISK_FLAG_PERMANENT_LIFETIME equ ATTACH_VIRTUAL_DISK_FLAG_PERMANENT_LIFETIME
SURFACE_VIRTUAL_DISK_FLAG_NO_LOCAL_HOST equ ATTACH_VIRTUAL_DISK_FLAG_NO_LOCAL_HOST
SURFACE_VIRTUAL_DISK_FLAG equ ATTACH_VIRTUAL_DISK_FLAG
_UNSURFACE_VIRTUAL_DISK_FLAG equ _DETACH_VIRTUAL_DISK_FLAG
UNSURFACE_VIRTUAL_DISK_FLAG_NONE equ DETACH_VIRTUAL_DISK_FLAG_NONE
UNSURFACE_VIRTUAL_DISK_FLAG equ DETACH_VIRTUAL_DISK_FLAG

else

SURFACE_VIRTUAL_DISK_FLAG typedef SDWORD
SURFACE_VIRTUAL_DISK_FLAG_NONE equ 0x00000000
SURFACE_VIRTUAL_DISK_FLAG_READ_ONLY equ 0x00000001
SURFACE_VIRTUAL_DISK_FLAG_NO_DRIVE_LETTER equ 0x00000002
SURFACE_VIRTUAL_DISK_FLAG_PERMANENT_LIFETIME equ 0x00000004
SURFACE_VIRTUAL_DISK_FLAG_NO_LOCAL_HOST equ 0x00000008

UNSURFACE_VIRTUAL_DISK_FLAG typedef SDWORD
UNSURFACE_VIRTUAL_DISK_FLAG_NONE equ 0x00000000

if NOT defined(VIRTDISK_DEFINE_FLAGS)

ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(SURFACE_VIRTUAL_DISK_FLAG);
endif
ifdef DEFINE_ENUM_FLAG_OPERATORS
DEFINE_ENUM_FLAG_OPERATORS(UNSURFACE_VIRTUAL_DISK_FLAG);
endif
endif

endif
endif ;; WIN32_WINNT_WIN7
endif ;; WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)
endif ;; VIRT_DISK_API_DEF

